<div ng-controller="Umbraco.Cms.Integrations.Automation.Zapier.ZapConfigController as vm">
    <umb-box>
        <umb-box-header title="Content Properties"></umb-box-header>
        <umb-box-content>
            <div>
                <p>
                    <a href="https://zapier.com/">Zapier</a> is an online platform that helps you automate workflows by connecting your apps and services you use.
                    This allows you to automate tasks without having to build this integration yourself.
                    When an event happens in one app, Zapier can tell another app to perform (or do) a particular action - no code necessary.
                </p>
                <p>
                    The heart of any automation boils down to this simple command: <b>WHEN</b> <span>this happens</span> <b>THEN</b> <span>do that</span>.
                </p>
                <p>
                    A Zap is an automated workflow that tells your apps to follow this simple command: "When this happens, do that."
                    Every Zap has a trigger and one or more actions. A trigger is an event that starts a Zap, and an action is what your Zap does for you.
                </p>
                <p>
                    Zap triggers use webhooks to execute the actions. Webhooks are automated messages sent from apps when something happens.
                </p>
                <p>
                    You can initiate your automation when a content item of a particular document type is published in Umbraco.
                </p>
                <p>
                    Using the filters below, map content items with Zap triggered webhooks.  This will:
                </p>
                <ul>
                    <li>Enable Zap invocations when content of the specified document type is published.</li>
                    <li>Trigger a sample request using the webhook URL to review when creating the Zap trigger.</li>
                </ul>
            </div>
            <div class="mt3">
                <input id="inWebHookUrl" type="text" ng-model="vm.webHookUrl" class="w-20 mb0" placeholder="WebHook URL" no-dirty-check />
                <select id="selContentTypes" ng-model="vm.selectedContentType" class="mb0" no-dirty-check>
                    <option value="">Please select a content type</option>
                    <option ng-repeat="item in vm.contentTypes" value="{{ item.name }}">{{ item.name }}</option>
                </select>
                <umb-button action="vm.onAdd()"
                            type="button"
                            button-style="primary"
                            label="Add">
                </umb-button>
            </div>
        </umb-box-content>
    </umb-box>
    <umb-box>
        <umb-box-header title="Registered Webhooks"></umb-box-header>
        <umb-content>
            <div class="mt2">

                <umb-load-indicator ng-show="vm.loading"></umb-load-indicator>

                <div class="umb-table" ng-if="vm.contentConfigs">
                    <!-- Listviews head section -->
                    <div class="umb-table-head">
                        <div class="umb-table-row">
                            <div class="umb-table-cell"></div>
                            <div class="umb-table-cell umb-table__name">
                                <a class="umb-table-head__link" href="#" prevent-default>
                                    <span>Content Type Name</span>
                                </a>
                            </div>
                            <div class="umb-table-cell">
                                <a class="umb-table-head__link" href="#" prevent-default>
                                    <span>WebHook URL</span>
                                </a>
                            </div>
                            <div class="umb-table-cell"></div>
                        </div>
                    </div>

                    <!-- Listview body section -->
                    <div class="umb-table-body">
                        <div class="umb-table-row"
                             ng-repeat="row in vm.contentConfigs track by $index">
                            <div class="umb-table-cell"></div>
                            <div class="umb-table-cell umb-table__name">
                                <span ng-bind="row.contentTypeName"></span>
                            </div>
                            <div class="umb-table-cell">
                                <span ng-bind="row.webHookUrl"></span>
                            </div>
                            <div class="umb-table-cell">
                                <umb-button action="vm.onTrigger(row.contentTypeName, row.webHookUrl)"
                                            label="Trigger Webhook"
                                            type="button"
                                            button-style="info">
                                </umb-button>
                                <umb-button action="row.showDeletePrompt = true"
                                            label="Delete"
                                            type="button"
                                            button-style="danger">
                                </umb-button>
                                <umb-confirm-action ng-if="row.showDeletePrompt"
                                                    direction="right"
                                                    on-confirm="vm.onDelete(row.id)"
                                                    on-cancel="row.showDeletePrompt = false">
                                </umb-confirm-action>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </umb-content>
    </umb-box>
</div>