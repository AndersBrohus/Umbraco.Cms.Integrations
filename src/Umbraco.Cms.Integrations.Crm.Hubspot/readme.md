# Umbraco.Cms.Integrations.Crm.Hubspot

This integration provides a form picker and rendering component for forms managed within a [Hubspot](https://www.hubspot.com/) account.

## Prerequisites

Requires minimum version of Umbraco CMS: 8.5.4.

## How To Use

### Authentication

The package supports two modes of authentication:

- API Key
- OAuth

#### API Key

Log into your HubSpot account, go to _Settings > Integrations > API Key_ and create an API key.

Add this to an app setting in `Web.config`:

```
  <appSettings>
    ...
    <add key="Umbraco.Cms.Integrations.Crm.Hubspot.ApiKey" value="[your API key]" />
    ...
  </appSettings>
```

#### OAuth

OAuth required parameters are represented by a group of constants in the _FormsController_ with the following values:
```
OAuthClientId
OAuthScopes
OAuthProxyBaseUrl
OAuthProxyEndpoint
```

No two set of app settings will work simultaneously.

#### Debug Configuration

While in DEBUG mode use following post build events:
```
  set UmbracoCmsIntegrationsTestsiteV8Path=$(SolutionDir)\Umbraco.Cms.Integrations.Testsite.V8
  set HubspotDir=%UmbracoCmsIntegrationsTestsiteV8Path%\App_Plugins\UmbracoCms.Integrations\Crm\Hubspot
  if not exist %HubspotDir% mkdir -p %HubspotDir%
  xcopy "$(ProjectDir)App_Plugins\UmbracoCms.Integrations\Crm\Hubspot" "%HubspotDir%" /e /y
```

### Backoffice usage

Property Editor will check the settings in `Web.config`, validate the configuration based on the existing
app settings and prompt the user a notification. 

If OAuth is available, then the _Connect_ button will be enabled, prompting the user, on clicked, 
with the HubSpot authorization window. The retrieved access token will be saved into the database and 
used for future requests. _Revoke_ action will remove the access token from the database and the authorization process will need to be repeated.

When a form is selected, the user needs to toggle the region flag notifying whether the data is stored in EU or US. This is very important as
it triggers the front-end JS script and the form creation depending on the region.


### Front-end rendering

A strongly typed model will be generated by the property value converter, and an HTML helper is available, to easily render the form on the front-end.

Ensure your template has a reference to the following using statement:

```
@using Umbraco.Cms.Integrations.Crm.Hubspot.Helpers;
```

And render the form using (assuming a property based on the created data type, with alias `hubSpotForm` has been created):

```
@Html.RenderHubspotForm(Model.HubspotForm)
```
