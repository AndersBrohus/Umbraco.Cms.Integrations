# Umbraco.Cms.Integrations.Crm.Hubspot

This integration provides a form picker and rendering component for forms managed within a [Hubspot](https://www.hubspot.com/) account.

## Prerequisites

Requires minimum version of Umbraco CMS: 8.5.4.

## How To Use

### Authentication

The package supports two modes of authentication:

- API Key
- OAuth

#### API Key

Log into your HubSpot account, go to _Settings > Integrations > API Key_ and create an API key.

Add this to an app setting in `Web.config`:

```
  <appSettings>
    ...
    <add key="Umbraco.Cms.Integrations.Crm.Hubspot.ApiKey" value="[your API key]" />
    ...
  </appSettings>
```

The key will be added to all requests made to the HubSpot API and used to authenticate access.

#### OAuth

If you prefer not to use an API key, an authentication flow using OAuth is also available.

To use this, simply ensure you don't have an API key in your configurataion file.

### Additional Configuration

To support multi-region HubSpot forms, the following app setting is required in `Web.config`:
```
  <appSettings>
    ...
    <add key="Umbraco.Cms.Integrations.Crm.Hubspot.Region" value="[region]" />
    ...
  </appSettings>
```

For example, in Europe, a setting of `eu1` should be used.

### Backoffice usage

To use the form picker, a new data type should be created based on the HubSpot Form Picker property editor.

The settings in `Web.config` will be checked and a message presented indicating whether authenticiation is in place.

If OAuth is being used for authentication is available, then the _Connect_ button will be enabled, prompting the user when clicked, 
with the HubSpot authorization window.

The retrieved access token will be saved into the database and used for future requests.

_Revoke_ action will remove the access token from the database and the authorization process will need to be repeated.

### Front-end rendering

A strongly typed model will be generated by the property value converter, and an HTML helper is available, to easily render the form on the front-end.

Ensure your template has a reference to the following using statement:

```
@using Umbraco.Cms.Integrations.Crm.Hubspot.Helpers;
```

And render the form using (assuming a property based on the created data type, with alias `hubSpotForm` has been created):

```
@Html.RenderHubspotForm(Model.HubspotForm)
```

### Developer Notes

To copy the front-end assets to the test site While in DEBUG mode, use following post build events:
```
  set UmbracoCmsIntegrationsTestsiteV8Path=$(SolutionDir)\Umbraco.Cms.Integrations.Testsite.V8
  set HubspotDir=%UmbracoCmsIntegrationsTestsiteV8Path%\App_Plugins\UmbracoCms.Integrations\Crm\Hubspot
  if not exist %HubspotDir% mkdir -p %HubspotDir%
  xcopy "$(ProjectDir)App_Plugins\UmbracoCms.Integrations\Crm\Hubspot" "%HubspotDir%" /e /y
```

