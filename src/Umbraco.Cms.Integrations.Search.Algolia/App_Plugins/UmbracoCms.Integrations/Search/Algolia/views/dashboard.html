<div ng-controller="Umbraco.Cms.Integrations.Search.Algolia.DashboardController as vm">

    <div ng-show="vm.loading">
        <umb-load-indicator></umb-load-indicator>
    </div>

    <div class="umb-panel-group__details">

        <div ng-if="vm.viewState == 'list'" class="umb-panel-group__details-group">
            <div class="umb-panel-group__details-group-title">
                <div class="umb-panel-group__details-group-name">
                    Algolia Indices
                </div>
            </div>
            <div class="umb-panel-group__details-checks">
                <div class="umb-panel-group__details-check-title">
                    <div class="umb-panel-group__details-check-name">Manage Algolia Indices</div>
                    <div class="umb-panel-group__details-check-description">Search the index and view the results</div>
                    <div class="umb-panel-group__details-check-description">
                        <umb-button type="button"
                                    button-style="primary"
                                    action="vm.addIndex()"
                                    label="Add">
                        </umb-button>
                    </div>
                </div>
                <div ng-if="vm.indices.length > 0" class="ml2 mr7 umb-panel-group__details-status">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Schema</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="index in vm.indices">
                                <td>
                                    <button type="button" class="btn-link -underline" ng-click="vm.viewIndex(index)">
                                        {{index.name}}
                                    </button>
                                </td>
                                <td>
                                    <p ng-repeat="item in index.contentData">{{ item.contentType }} - {{ item.properties.join() }}</p>
                                </td>
                                <td>
                                    <umb-button label="build"
                                                type="button"
                                                button-style="danger"
                                                action="vm.buildIndex(index)">
                                    </umb-button>
                                    <umb-button label="search"
                                                type="button"
                                                button-style="success">
                                    </umb-button>
                                    <umb-button label="delete"
                                                type="button"
                                                button-style="inverse"
                                                action="vm.deleteIndex(index)">
                                    </umb-button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <br />
        <div ng-if="vm.viewState === 'manage'">
            <umb-editor-sub-header>
                <umb-editor-sub-header-content-left>
                    <button type="button" class="umb-package-details__back-action" ng-click="vm.manageIndex.reset();vm.viewState = 'list';">
                        <span aria-hidden="true">&larr;</span>
                        Back
                    </button>
                </umb-editor-sub-header-content-left>
            </umb-editor-sub-header>
            <div class="umb-panel-group__details-group">
                <div class="umb-panel-group__details-group-title">
                    <div class="umb-panel-group__details-group-name">
                        Manage Index
                    </div>
                </div>
                <div class="umb-panel-group__details-checks">
                    <!-- Content Type, Index Name -->
                    <div class="umb-panel-group__details-check">
                        <div class="umb-panel-group__details-check-title">
                            <div class="umb-panel-group__details-check-name">Content Types</div>
                            <div class="umb-panel-group__details-check-description">Please select the content types you want to index</div>
                        </div>
                        <div class="umb-panel-group__details-status">
                            <div class="umb-panel-group__details-status-content">
                                <div class="row">
                                    <div class="flex">
                                        <div class="mt2">
                                            <label>Index Name</label>
                                        </div>
                                        <div class="ml2">
                                            <input type="text" ng-model="vm.manageIndex.name" no-dirty-check />
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="flex justify-start">
                                        <div>
                                            <h5>Content Types</h5>
                                            <div class="mt2" ng-repeat="contentType in vm.manageIndex.contentTypes">
                                                <div class="flex content-start flex-wrap">
                                                    <div>
                                                        <umb-toggle checked="contentType.checked"
                                                                    on-click="vm.manageIndex.selectContentType(contentType)"
                                                                    show-labels="true"
                                                                    label-on="{{contentType.name}}"
                                                                    label-off="{{contentType.name}}"
                                                                    label-position="right">
                                                        </umb-toggle>
                                                    </div>
                                                    <div class="ml2">
                                                        <button ng-if="contentType.checked"
                                                                type="button"
                                                                style="border-top-width: 0;padding-top:0;"
                                                                class="btn-link -underline" ng-click="vm.manageIndex.showProperties(contentType)">
                                                            show properties
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div ng-if="vm.manageIndex.properties.length > 0">
                                            <h5>Properties</h5>
                                            <div class="mt2" ng-repeat="property in vm.manageIndex.properties">
                                                <div class="flex content-start flex-wrap">
                                                    <div>
                                                        <umb-toggle checked="property.checked"
                                                                    on-click="vm.manageIndex.selectProperty(property)"
                                                                    show-labels="true"
                                                                    label-on="{{ property.display }}"
                                                                    label-off="{{ property.display }}"
                                                                    label-position="right">
                                                        </umb-toggle>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt2 row">
                                    <umb-button type="button"
                                                button-style="success"
                                                action="vm.saveIndex()"
                                                label="Save">
                                    </umb-button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        <br />
        <div ng-if="vm.viewState === 'search'">
            <umb-editor-sub-header>
                <umb-editor-sub-header-content-left>
                    <button type="button" class="umb-package-details__back-action" ng-click="vm.searchIndex={};vm.viewState = 'list';">
                        <span aria-hidden="true">&larr;</span>
                        Back
                    </button>
                </umb-editor-sub-header-content-left>
            </umb-editor-sub-header>
            <div class="umb-panel-group__details-group">
                <div class="umb-panel-group__details-group-title">
                    <div class="umb-panel-group__details-group-name">
                        Search
                    </div>
                </div>
                <div class="umb-panel-group__details-checks">
                    <!-- Content Type, Index Name -->
                    <div class="umb-panel-group__details-check">
                        <div class="umb-panel-group__details-check-title">
                            <div class="umb-panel-group__details-check-name">Search over index</div>
                            <div class="umb-panel-group__details-check-description">Please select the content types you want to index</div>
                        </div>
                        <div class="umb-panel-group__details-status">
                            <div class="umb-panel-group__details-status-content">
                                <div class="row">
                                    <div class="flex">
                                        <div class="mt2" style="width:50%">
                                            <input type="text" style="width:100%" ng-model="vm.searchQuery" no-dirty-check />
                                        </div>
                                        <div class="mt2">
                                            <umb-button type="button"
                                                        button-style="success"
                                                        action="vm.search()"
                                                        label="Search"
                                                        label-key="general_search">
                                            </umb-button>
                                        </div>
                                    </div>
                                </div>
                                <div>
                                    <!--RESULTS -->
                                    <div>
                                        <p>Items Count: {{ vm.searchResults.itemsCount }}</p>
                                        <p>Pages Count: {{ vm.searchResults.pagesCount }}</p>
                                        <p>Items per Page: {{ vm.searchResults.itemsPerPage }}</p>
                                        <div ng-repeat="record in vm.searchResults.hits">
                                            <p ng-repeat="(key, value) in record">
                                                <b>{{ key }}</b> : {{ value }}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
